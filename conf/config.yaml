# Ariel Configuration
# Main configuration file for training and inference

# Experiment metadata
experiment_name: ariel_snemi3d
project_name: ariel-connectomics
seed: 42

# Logging
logger: tensorboard  # Options: tensorboard, wandb
log_dir: logs

# Label configuration
labels:
  background: 0
  neuron: 1  # Instance segmentation class
  mitochondria: 2  # Semantic segmentation class
  synapse: 3  # Semantic segmentation class
  membrane: 4  # Semantic segmentation class

# Data configuration
data:
  data_root: data
  batch_size: 4
  num_workers: 4
  train_val_split: 0.2  # 80/20 train/val split
  cache_rate: 0.5  # Cache 50% of training data
  pin_memory: true
  
  # Augmentation settings
  augmentation:
    enabled: true
    rand_flip_prob: 0.5
    rand_rotate_prob: 0.5
    rand_zoom_prob: 0.2
    rand_gaussian_noise_prob: 0.2
    rand_adjust_contrast_prob: 0.2

# Model configuration
model:
  net_config:
    in_channels: 1
    init_filters: 32
    feature_dim: 64  # Backbone output dimension
    emb_dim: 16  # Instance embedding dimension
    dropout: 0.2
    blocks_down: [1, 2, 2, 4]
    blocks_up: [1, 1, 1]
  
  optimizer:
    lr: 1.0e-4
    weight_decay: 1.0e-5
    scheduler:
      type: cosine
      T_max: 100
      eta_min: 1.0e-6
  
  loss:
    # Instance embedding loss (contrastive)
    embedding_weight: 1.0
    margin: 0.5
    
    # Semantic segmentation loss (cross-entropy)
    semantic_weight: 1.0
    class_weights: null  # Auto-compute from data if null

# Training configuration
training:
  max_epochs: 100
  accelerator: auto  # Options: cpu, gpu, tpu, auto
  devices: 1  # Number of devices
  strategy: auto  # Options: auto, ddp, ddp_find_unused_parameters_true
  precision: 32-true  # Options: 32-true, 16-mixed, bf16-mixed
  
  # Gradient settings
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  
  # Validation settings
  val_check_interval: 1.0  # Validate every epoch
  check_val_every_n_epoch: 1
  num_sanity_val_steps: 2
  
  # Logging settings
  log_every_n_steps: 50
  enable_progress_bar: true
  enable_model_summary: true
  
  # Performance settings
  deterministic: false
  benchmark: true
  fast_dev_run: false  # Set to true for quick testing

# Callbacks configuration
callbacks:
  checkpoint:
    enabled: true
    dirpath: checkpoints
    filename: ariel-{epoch:02d}-{val/loss:.4f}
    save_top_k: 3
    monitor: val/loss
    mode: min
    save_last: true
    verbose: true
  
  early_stopping:
    enabled: false
    monitor: val/loss
    patience: 20
    mode: min
    verbose: true
    min_delta: 0.0
  
  lr_monitor:
    enabled: true
  
  visualization:
    enabled: true
    log_every_n_steps: 200
    num_samples: 2

# Hydra configuration
hydra:
  run:
    dir: outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}
  sweep:
    dir: multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}
    subdir: ${hydra.job.num}

